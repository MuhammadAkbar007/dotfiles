### ~/.config/tmux/.tmux.conf ###
### https://github.com/catppuccin/tmux ###
# reload tmux config
bind R source-file "$HOME/.tmux.conf" \; display-message "Config reloading.."

# prefix
unbind C-b
set -g prefix C-a
bind C-a send-prefix

bind s choose-tree -s

set-option -g mouse on # Enable mouse
set-option -g default-shell "/bin/zsh"
set -g allow-passthrough on # let unbound keymaps into program inside tmux
set -g base-index 1 # start indexing windows at 1 instead of 0
set -s escape-time 0 # zero-out escape time delay
set -s repeat-time 300 # repeat command without prefix time
setw -g monitor-activity on # notify status bar by flashing

# Check if tmux-256color terminfo exists
if-shell 'infocmp -x tmux-256color > /dev/null 2>&1' \
  'set -g default-terminal "tmux-256color"' \
  'set -g default-terminal "xterm-256color"'
set-option -sa terminal-overrides ",xterm*:Tc"

# For image processing
set -gq allow-passthrough on
set -g visual-activity off

# splitting windows
unbind '%'
unbind '"'
bind '\' splitw -h -c '#{pane_current_path}'
bind '-' splitw -v -c '#{pane_current_path}'

# window
bind ` last-window

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# Ctrl Alt vim keys to switch windows
bind -n C-M-h previous-window
bind -n C-M-l next-window

# Shift arrow to switch windows
bind -n S-Left  previous-window
bind -n S-Right next-window

# resize & maximize pane
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5
bind -r h resize-pane -L 5
bind -r z resize-pane -Z

# Vim style move, select, yank & past
setw -g mode-keys vi
bind -r v copy-mode # lets you insert into copy mode
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind p paste-buffer
bind -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"

# Additional configs
set -g renumber-windows on 	# renumber all windows when any window is closed
set -g pane-base-index 1
set-window-option -g pane-base-index 1
set-option -g focus-events on

# new window with current path
bind-key w new-window -c "#{pane_current_path}"

# swith to last session
bind-key l switch-client -l

# remove delay for exiting insert mode with ESC in Neovim
set -sg escape-time 10

# rename-window binding
bind-key r command-prompt -I "rename-window "

# bootstrap tpm
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# tpm plugins
run ~/.config/tmux/plugins/catppuccin/tmux/catppuccin.tmux
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'omerxx/tmux-floax'

# tmux-floax config
set -g @floax-border-color 'yellow' # black, red, green, yellow, blue, magenta, cyan, white
set -g @floax-text-color 'blue'
set -g @floax-bind 'f'

# tmux-yank config
set -g @yank_selection_mouse 'clipboard' # or 'primary' or 'secondary'

# tmux restoring config
set -g @continuum-restore 'off'
set -g @continuum-save-interval '15'  # Save every 15 minutes
set -g @resurrect-strategy-vim 'session'
set -g @resurrect-strategy-nvim 'session'
set -g @resurrect-processes '~Vim -> vim'
set -g @resurrect-capture-pane-contents 'off'

# vim-tmux-navigator config
set -g @vim_navigator_mapping_left "C-h"
set -g @vim_navigator_mapping_right "C-l"
set -g @vim_navigator_mapping_up "C-k"
set -g @vim_navigator_mapping_down "C-j"
set -g @vim_navigator_mapping_prev ""

# config catppucin color
if-shell '[ -f ~/dotfiles/colors.conf ]' "source-file ~/dotfiles/colors.conf"

# Configure Catppuccin
set -g @catppuccin_flavor "macchiato"
set -g @catppuccin_status_background "none"
set -g @catppuccin_window_status_style "none"
set -g @catppuccin_pane_status_enabled "off"
set -g @catppuccin_pane_border_status "off"

# status left look and feel
set -g status-left-length 1000
set -g status-left ""
set -ga status-left "#{?client_prefix,#{#[bg=#{@thm_red},fg=#{@thm_bg},bold]  #S },#{#[bg=default,fg=#{@thm_green}]  #S }}" # session
set -ga status-left "#[bg=default,fg=#{@thm_overlay_0},none]│" # separator
set -ga status-left "#[bg=default,fg=#{@thm_yellow}]#{?window_zoomed_flag,  zoom ,}" # zoom indicator if on

# status right look and feel
set -g status-right-length 1000
set -g status-justify "right"
set -g status-right ""
set -ga status-right "#[bg=default,fg=#{@thm_blue},bold]   #{s|/home/$USER|~|:#{pane_current_path}} "
# set -ga status-right "#{?#{e|>=:10,#{battery_percentage}},#{#[bg=#{@thm_red},fg=#{@thm_bg}]},#{#[bg=#{@thm_bg},fg=#{@thm_pink}]}} #{battery_icon} #{battery_percentage} "
# set -ga status-right "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}, none]│"
# set -ga status-right "#[bg=#{@thm_bg}]#{?#{==:#{online_status},ok},#[fg=#{@thm_mauve}] 󰖩 on ,#[fg=#{@thm_red},bold]#[reverse] 󰖪 off }"

# Configure Tmux
set -g status-position top
set -g status-style "bg=default"
set -g status-justify "absolute-centre"

# pane border look and feel
setw -g pane-border-status off
setw -g pane-border-format ""
setw -g pane-border-style "bg=default,fg=#{@thm_overlay0}"
setw -g pane-active-border-style "bg=default,fg=#{@thm_red}"
setw -g pane-border-lines single

# window look and feel
# set -wg automatic-rename on
# set -g automatic-rename-format "#{pane_current_command}"
# set -g window-status-format " #I#{?#{!=:#{window_name},Window},: #W,} "
# set -g window-status-style "bg=#{@thm_bg},fg=#{@thm_rosewater}"
# set -g window-status-last-style "bg=#{@thm_bg},fg=#{@thm_peach}"
# set -g window-status-activity-style "bg=#{@thm_red},fg=#{@thm_bg}"
# set -g window-status-bell-style "bg=#{@thm_red},fg=#{@thm_bg},bold"
# set -gF window-status-separator "#[bg=#{@thm_bg},fg=#{@thm_overlay_0}]│"
# set -g window-status-current-format " #I#{?#{!=:#{window_name},Window},: #W,} "
# set -g window-status-current-style "bg=#{@thm_peach},fg=#{@thm_bg},bold"

# minimalistic windows
set -g window-status-format " #I|  #W "
set -g window-status-style "bg=black,fg=#{@thm_green}"
set -g window-status-separator " "
set -g window-status-current-format "#[fg=#{@thm_base},bg=#{@thm_green},bold] #I|  #W #[default]"
set -g window-status-current-style "bg=#{@thm_green},fg=#{@thm_base},bold"
set -g window-status-activity-style "bg=black,fg=#{@thm_green}"
set -g window-status-last-style "bg=black,fg=#{@thm_green}"

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
